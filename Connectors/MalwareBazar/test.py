#!/usr/bin/env python3
from datetime import datetime
from email.utils import parsedate_tz, mktime_tz
import requests
import sys
import argparse
import json

from jq import jq


parser = argparse.ArgumentParser(description='Get most recent samples on Malware Bazaar by abuse.ch')
parser.add_argument('-s', '--selector', help='Selector type you want', type=str, metavar="SELECTOR", required=False, default="100", choices=['100', 'time'])
parser.add_argument('-f', '--field', help='Single field you want', type=str, metavar="FIELD", required=False, choices=['sha256_hash', 'sha1_hash', 'md5_hash', 'file_name', 'signature', 'imphash'])

args = parser.parse_args()

headers = { 'API-KEY': '0c00aac4d559f7f3a424335cf247d4cd' }

url = "https://mb-api.abuse.ch/api/v1/"
headers = {
    "Accept": "application/json",
    "Content-Type": "application/x-www-form-urlencoded",
    "API-KEY": "0c00aac4d559f7f3a424335cf247d4cd",
}
params = {"query": "get_info", "hash": "094fd325049b8a9cf6d3e5ef2a6d4cc6a567d7d49c35f8bb8dd9e3c6acf3d78d"}		
r = requests.post(url, headers=headers, data=params)
r.raise_for_status()
data = r.json()
#print(data)
data = data["data"][0]
print(data)
print(data["file_size"])
print(data["first_seen"])



pubdt = datetime.strptime(data["first_seen"], "%Y-%m-%d %H:%M:%S")
print(pubdt)
#f = open("response.log", "w")
#f.write(json_response)
#f.close()
