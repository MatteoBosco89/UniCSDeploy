#!/usr/bin/env python3
import requests
import sys
import argparse
import json

from jq import jq


parser = argparse.ArgumentParser(description='Get most recent samples on Malware Bazaar by abuse.ch')
parser.add_argument('-s', '--selector', help='Selector type you want', type=str, metavar="SELECTOR", required=False, default="100", choices=['100', 'time'])
parser.add_argument('-f', '--field', help='Single field you want', type=str, metavar="FIELD", required=False, choices=['sha256_hash', 'sha1_hash', 'md5_hash', 'file_name', 'signature', 'imphash'])

args = parser.parse_args()

headers = { 'API-KEY': '0c00aac4d559f7f3a424335cf247d4cd' }

url = "https://mb-api.abuse.ch/api/v1/"
headers = {
    "Accept": "application/json",
    "Content-Type": "application/x-www-form-urlencoded",
    "API-KEY": "0c00aac4d559f7f3a424335cf247d4cd",
}
params = {"selector": "time", "query": "get_recent"}	
r = requests.post(url, headers=headers, data=params)
r.raise_for_status()
data = r.json()
if(data["query_status"] == "ok"): print("ciaone")
data = data["data"]
for k in data:
    print(k)
    print("\n")



#f = open("response.log", "w")
#f.write(json_response)
#f.close()
